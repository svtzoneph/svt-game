<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Match the Card SVT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ff85c1" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="svt_memory_game.png" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <style>
  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #f7cfe3, #c6dff5);
  }

  h1 {
    margin-top: 30px;
    text-align: center;
    font-size: 2rem;
  }

  main {
    flex: 1;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  button {
    background: #ff85c1;
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 10px;
    font-size: 1.2rem;
    cursor: pointer;
    transition: 0.2s;
  }

  button:hover {
    background: #e66cae;
    transform: scale(1.05);
  }

  .bottom-buttons {
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
    width: 100%;
  }

  footer {
    text-align: center;
    padding: 15px;
    font-size: 0.9rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    width: 100%;
  }

  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 99;
    padding: 20px;
    box-sizing: border-box;
  }

.modal-content {
  background: #222;
  color: white;
  padding: 30px;
  border-radius: 15px;
  width: 100%;
  max-width: 600px;
  max-height: 90vh; /* restrict height */
  overflow-y: auto;  /* allow vertical scroll */
  text-align: center;
  box-sizing: border-box;
}

  .avatar-option {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid transparent;
    cursor: pointer;
  }

  .avatar-option:hover {
    border-color: #ff85c1;
    transform: scale(1.1);
  }

  #avatarPreview {
    margin-top: 10px;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid #ff85c1;
  }

  input {
    padding: 10px;
    font-size: 1rem;
    border-radius: 8px;
    width: 80%;
    max-width: 300px;
    margin: 10px 0;
    border: none;
    outline: none;
  }

  .leaderboard-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  .leaderboard-table th,
  .leaderboard-table td {
    padding: 10px;
    color: white;
  }

  .leaderboard-table thead {
    background: #ff85c1;
  }

  .leaderboard-table tbody tr:nth-child(even) {
    background: #333;
  }

  .highlight {
    background-color: gold;
    color: black;
  }
  
  .profile-buttons {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 20px;
  flex-wrap: wrap;
}

  @media (max-width: 500px) {
    h1 {
      font-size: 1.6rem;
    }

    button {
      width: 90%;
      font-size: 1rem;
    }

    .modal-content {
  background: #222;
  color: white;
  padding: 30px;
  border-radius: 15px;
  width: 100%;
  max-width: 600px;
  max-height: 90vh; /* restrict height */
  overflow-y: auto;  /* allow vertical scroll */
  text-align: center;
  box-sizing: border-box;
}
    .leaderboard-table th,
    .leaderboard-table td {
      font-size: 0.85rem;
      padding: 8px;
    }

    #avatarPreview {
      width: 80px;
      height: 80px;
    }

    .avatar-option {
      width: 50px;
      height: 50px;
    }
  }
</style>
</head>
<body>

  <h1>Match the Card SVT</h1>

  <main>
    <button onclick="startGame()">üéÆ Start Game</button>
  </main>

  <div class="bottom-buttons">
    <button onclick="document.getElementById('profileModal').style.display='flex'">üë§ Profile</button>
    <button onclick="document.getElementById('leaderboardModal').style.display='flex'; loadLeaderboard();">üèÜ Leaderboard</button>
    <button onclick="document.getElementById('aboutModal').style.display='flex'">‚ÑπÔ∏è About</button>
  </div>

  <footer>
    <p>Made for CARATs üíé | Match the Card SVT</p>
  </footer>

  <!-- Profile Modal -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <h2>Edit Profile</h2>
      <input type="text" id="profileName" placeholder="Enter your name" /><br>
      <p>Select Avatar:</p>
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen10-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen13-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen9-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen8-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen11-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen12-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen7-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen6-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen5-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen4-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen3-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen2-768x768.png" class="avatar-option" onclick="selectAvatar(this)">
        <img src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen1-800x800.png" class="avatar-option" onclick="selectAvatar(this)">
      </div>
      <p>Selected Avatar:</p>
      <img id="avatarPreview" src="https://uploads.onecompiler.io/432zqmf3k/43mwmcrmj/miniteen10-768x768.png" alt="Preview" />
      <br><br>
      <div class="profile-buttons">
  <button onclick="saveProfile()">üíæ Save</button>
  <button onclick="document.getElementById('profileModal').style.display='none'">‚ùå Close</button>
</div>
    </div>
  </div>

  <!-- Leaderboard Modal -->
  <div id="leaderboardModal" class="modal">
    <div class="modal-content">
      <h2>üèÜ Leaderboard</h2>
      <table class="leaderboard-table">
        <thead><tr><th>Rank</th><th>Name</th><th>Level</th><th>Score</th></tr></thead>
        <tbody id="leaderboardList">
          <tr><td colspan="4">Loading...</td></tr>
        </tbody>
      </table>
      <button onclick="document.getElementById('leaderboardModal').style.display='none'">Close</button>
    </div>
  </div>

  <!-- About Modal -->
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <h2>About the Game</h2>
      <p><strong>Match the Card SVT</strong> is a fun and challenging memory game made especially for SEVENTEEN fans! ü©∑‚ú®</p>

  <p>Your goal is simple: flip the cards and find the matching pairs. If the two cards you flip are a match, they stay open. If not, they‚Äôll flip back, and you‚Äôll need to remember their positions for later.</p>

  <p>But that‚Äôs not all ‚Äî the game gets harder as you progress!</p>

  <ul>
    üß† 100 exciting levels to complete, with increasing difficulty!</li>
    üí° Test your memory, speed, and focus!</li>
    üíé The faster and smarter you play, the higher your score!</li>
    ü•á Compete on the leaderboard to earn ranks and medals!</li>
    üîì Unlock new levels as you match your way to the top!</li>
  </ul>

  <p><strong>Match the Card SVT</strong> is a completely free and fun way to boost your memory and focus while challenging yourself through 100 exciting levels!</p>
  <p><em>üõ†Ô∏è More updates, features, and surprises will be added soon ‚Äî stay tuned!</em></p>
      <button onclick="document.getElementById('aboutModal').style.display='none'">Close</button>
    </div>
  </div>

 <script>
  const firebaseConfig = {
    apiKey: "AIzaSyAs2S6iRhnYhmqNuF0QCCYu5NuzxHxIRv0",
    authDomain: "tvnstream-b4497.firebaseapp.com",
    databaseURL: "https://tvnstream-b4497-default-rtdb.firebaseio.com",
    projectId: "tvnstream-b4497",
    storageBucket: "tvnstream-b4497.appspot.com",
    messagingSenderId: "308384754214",
    appId: "1:308384754214:web:2938e76cd29b288f75d4e7"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const profileNameInput = document.getElementById("profileName");
  const avatarPreview = document.getElementById("avatarPreview");

  // On load, fill profile if already saved
  window.onload = async () => {
    const savedName = localStorage.getItem("playerName");
    const savedAvatar = localStorage.getItem("playerAvatar");

    if (savedName) {
      profileNameInput.value = savedName;
      profileNameInput.readOnly = true; // prevent name change
      avatarPreview.src = savedAvatar || avatarPreview.src;

      // Optionally fetch from Firebase to update avatar
      const snap = await db.ref("profiles/" + savedName).get();
      if (snap.exists()) {
        const profile = snap.val();
        avatarPreview.src = profile.avatar;
        localStorage.setItem("playerAvatar", profile.avatar);
      }
    }
  };

  function selectAvatar(img) {
    avatarPreview.src = img.src;
  }

  async function saveProfile() {
    const name = profileNameInput.value.trim();
    const avatar = avatarPreview.src;

    if (!name) return alert("Please enter your name!");

    const profileRef = db.ref("profiles/" + name);
    const snap = await profileRef.get();

    // Name already saved (readonly), just update avatar
    if (profileNameInput.readOnly) {
      await profileRef.update({ avatar });
      localStorage.setItem("playerAvatar", avatar);
      alert("‚úÖ Avatar updated!");
      document.getElementById("profileModal").style.display = 'none';
      return;
    }

    // Name not used yet ‚Üí save full profile
    if (snap.exists()) {
      alert("‚ùå Name already taken. Please choose another.");
      return;
    }

    await profileRef.set({ name, avatar });
    localStorage.setItem("playerName", name);
    localStorage.setItem("playerAvatar", avatar);
    alert("‚úÖ Profile saved!");
    profileNameInput.readOnly = true;
    document.getElementById("profileModal").style.display = 'none';
  }

  function startGame() {
    const name = localStorage.getItem("playerName");
    if (!name) return alert("Please save your profile first!");
    window.location.href = "game.html?playerName=" + encodeURIComponent(name);
  }

 function loadLeaderboard() {
  const list = document.getElementById("leaderboardList");
  list.innerHTML = `<tr><td colspan="4">Loading...</td></tr>`;

  const scoresRef = db.ref("scores");
  const progressRef = db.ref("progress");

  Promise.all([
    scoresRef.once("value"),
    progressRef.once("value")
  ]).then(([scoreSnap, progressSnap]) => {
    const scores = scoreSnap.val() || {};
    const progress = progressSnap.val() || {};

    const combined = Object.entries(scores).map(([name, data]) => ({
      name,
      score: data.total || 0,
      level: progress[name]?.currentLevel - 1 || 1
    }));

    combined.sort((a, b) => b.score - a.score);

    if (combined.length === 0) {
      list.innerHTML = `<tr><td colspan="4">No scores yet.</td></tr>`;
      return;
    }

    list.innerHTML = combined.map((entry, i) => {
      let rankDisplay = i + 1;
      if (i === 0) rankDisplay = 'ü•á';
      else if (i === 1) rankDisplay = 'ü•à';
      else if (i === 2) rankDisplay = 'ü•â';

      return `
        <tr>
          <td>${rankDisplay}</td>
          <td>${entry.name}</td>
          <td>${entry.level}</td>
          <td>${entry.score}</td>
        </tr>
      `;
    }).join('');
  });
}
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js');
  }
</script>
</body>
</html>
